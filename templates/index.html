<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/bootstrap-datetimepicker.min.css">

    <style>
        td {
            width: 60px;
            height: 60px;

        }

        .cl {
            background-color: yellow;
        }

        .hid {
            display: none;
        }
    </style>
</head>
<body>
{% csrf_token %}
<div class="container" style="margin-top: 50px">
    <h1>会议室预定</h1>

    <div class="row">
        <div class="col-md-4 col-md-offset-8">
            <div class="col-md-8 col-md-offset-2">
                <div class="form-group inline-group">
                    <div class="input-group date form_date" data-date="" data-date-format="dd MM yyyy"
                         data-link-field="dtp_input2" data-link-format="yyyy-mm-dd">
                        <input class="form-control" size="16" type="text" value="" id="rli" readonly/>
                        <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                    </div>
                    <input type="hidden" id="dtp_input2" value=""/><br/>
                </div>
            </div>
            <div class="col-md-2" style="padding-left: 0">
                <button class="btn btn-primary save_data">保存</button>
            </div>
        </div>

    </div>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th>会议室</th>
            {% for time in times %}
                <th class="{{ forloop.counter }}">{{ time }}</th>
            {% endfor %}
        </tr>
        </thead>
        {% for room in rooms %}
            <tbody>

            <tr>

                <td class="{{ room.id }}">{{ room }}</td>
                <td class="ite" id="1"></td>
                <td class="ite" id="2"></td>
                <td class="ite" id="3"></td>
                <td class="ite" id="4"></td>
                <td class="ite" id="5"></td>
                <td class="ite" id="6"></td>
                <td class="ite" id="7"></td>
                <td class="ite" id="8"></td>
                <td class="ite" id="9"></td>
                <td class="ite" id="10"></td>
                <td class="ite" id="11"></td>
                <td class="ite" id="12"></td>
                <td class="ite" id="13"></td>


            </tr>
            </tbody>
        {% endfor %}
    </table>

</div>
<script type="text/javascript" src="/static/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.cookie.js"></script>
<script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/static/js/bootstrap-datetimepicker.js"></script>
<script type="text/javascript" src="/static/js/bootstrap-datetimepicker.de.js"></script>
<script type="text/javascript">

    $('.form_date').datetimepicker({
        format: 'yyyy-mm-dd',
        language: 'de',
        weekStart: 1,
        todayBtn: 1,
        autoclose: 1,
        todayHighlight: 1,
        startView: 2,
        minView: 2,
        forceParse: 0
    });


    $(".ite").click(function () {
        $(this).toggleClass("cl");
    });

    $(".save_data").click(function () {
        var data_list = [];
        $(".cl").each(function () {

            tem = {
                "room_id": $(this).parent().children().first().attr("class"),
                "time_id": $(this).attr("id"),
                "day": $("#rli").val()
            };
            data_list.push(tem);

        });


        $.post({
            url: "/index/",
            headers: {"X-CSRFToken": $.cookie("csrftoken")},
            data: JSON.stringify(data_list),
            contentType: "application/json",
            success: function (data) {
                if(data["success"]){
                    $(".cl").text(data["user"]);
                    $(".cl").css({"background-color":"gold","disabled":"disabled"});
                    $("#rli").val(data["day"])
                }
                else{
                    alert("预定失败，请检查您的订单")
                }
            }


        })

    });

    $.ajax({
        

    })

</script>
</body>
</html>